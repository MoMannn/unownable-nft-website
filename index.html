<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
      integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"
      type="application/javascript"
    ></script>
    <script src="./abi.js" type="application/javascript"></script>
    <script>
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      const nftAddress = "0x45cFFcC1dE8cb677D54B496168152473A4de8873";

      $(async function () {
        await ethereum.request({ method: "eth_requestAccounts" });
        await loadNFT();
      });

      async function loadNFT() {
        const contract = new ethers.Contract(nftAddress, nftAbi, provider);
        const address = await provider.getSigner().getAddress();
        console.log(address);

        const owner = await contract.ownerOf(1);
        $("#nfts").html("");

        const url = await contract.tokenURI(1);

        let metadata = null;
        try {
          metadata = await $.getJSON(url);
        } catch (e) {
          console.log(e);
          metadata = {
            name: "",
            description: "",
            image: "",
          };
        }
        $("#nfts").append(`
            <div id="nft" class="col-sm-3">
              <h3>${metadata.name}</h3>
              <p>${metadata.description}</p>
              <img class="img-fluid" src="${metadata.image}" />
              <p>Currently in possession of: ${owner}</p>
            </div>
          `);
      }

      async function takePossession() {
        const nft = new ethers.Contract(nftAddress, nftAbi, provider).connect(
          provider.getSigner()
        );
        const tx = await nft.takePossession();
        console.log(tx);
      }
    </script>

    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <h1>Unownable NFT</h1>
          <button onclick="takePossession()">Take possession</button>
        </div>
      </div>
      <br />
      <div class="row"></div>
      <div class="row" id="nfts"></div>
    </div>
  </body>
</html>
